# Dockerfile for ace-app
FROM tomcat:7.0.72-jre8
LABEL MAINTAINER QUIK Computing <info@quik-j.com>

ARG ACE3_APP_DATA_HOST=db
ENV ACE3_APP_DATA_HOST $ACE3_APP_DATA_HOST

ARG ACEOPERATOR_SQL_HOST=db
ENV ACEOPERATOR_SQL_HOST $ACEOPERATOR_SQL_HOST

ARG ACEOPERATOR_SQL_PORT=3306
ENV ACEOPERATOR_SQL_PORT $ACEOPERATOR_SQL_PORT

ARG ACEOPERATOR_SQL_DB=webtalk
ENV ACEOPERATOR_SQL_DB $ACEOPERATOR_SQL_DB

ARG ACEOPERATOR_SQL_USER=ace
ENV ACEOPERATOR_SQL_USER $ACEOPERATOR_SQL_USER

ARG ACEOPERATOR_SQL_PASSWORD=a1b2c3d4
ENV ACEOPERATOR_SQL_PASSWORD $ACEOPERATOR_SQL_PASSWORD

ARG ACEOPERATOR_SMTP_SERVER=mail
ENV ACEOPERATOR_SMTP_SERVER $ACEOPERATOR_SMTP_SERVER

ARG ACEOPERATOR_SMTP_PORT=25
ENV ACEOPERATOR_SMTP_PORT $ACEOPERATOR_SMTP_PORT

ARG ACEOPERATOR_SMTP_USER=
ENV ACEOPERATOR_SMTP_USER $ACEOPERATOR_SMTP_USER

ARG ACEOPERATOR_SMTP_PASSWORD=
ENV ACEOPERATOR_SMTP_PASSWORD $ACEOPERATOR_SMTP_PASSWORD

ARG ACEOPERATOR_ADMIN_PASSWORD=a1b2c3d4
ENV ACEOPERATOR_ADMIN_PASSWORD $ACEOPERATOR_ADMIN_PASSWORD

ARG ACEOPERATOR_MAIL_ENCRYPT=false
ENV ACEOPERATOR_MAIL_ENCRYPT $ACEOPERATOR_MAIL_ENCRYPT

ARG ACEOPERATOR_MAIL_OVERRIDE_FROM=
ENV ACEOPERATOR_MAIL_OVERRIDE_FROM $ACEOPERATOR_MAIL_OVERRIDE_FROM

ARG ACEOPERATOR_RECAPTCHA_SECRET=
ENV ACEOPERATOR_RECAPTCHA_SECRET $ACEOPERATOR_RECAPTCHA_SECRET

ARG ACE3_CNTSYNC=true
ENV ACE3_CNTSYNC $ACE3_CNTSYNC

RUN apt-get update; apt-get -y install nmap

COPY work/common/scripts/*.sh /usr/share/aceoperator/bin/

# blow up apps included with default tomcat
RUN rm -rf /usr/local/tomcat/webapps/*

COPY *.sh /usr/share/aceoperator/bin/
RUN chmod +x /usr/share/aceoperator/bin/*.sh

COPY work/webapps /usr/local/tomcat/webapps
COPY server.xml /usr/local/tomcat/conf

# Expose 6970 so that the outside world can check for app start
EXPOSE 6970 8080 8443 8009

ENTRYPOINT ["/usr/share/aceoperator/bin/run.sh"]