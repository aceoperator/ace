# Dockerfile for ace-app
FROM ubuntu:disco
LABEL MAINTAINER QUIK Computing <info@quik-j.com>

ARG ACEOPERATOR_SQL_HOST=db
ENV ACEOPERATOR_SQL_HOST $ACEOPERATOR_SQL_HOST

ARG ACEOPERATOR_SQL_PORT=3306
ENV ACEOPERATOR_SQL_PORT $ACEOPERATOR_SQL_PORT

ARG ACEOPERATOR_SQL_DB=webtalk
ENV ACEOPERATOR_SQL_DB $ACEOPERATOR_SQL_DB

ARG ACEOPERATOR_SQL_ROOT_PASSWORD=a1b2c3d4
ENV ACEOPERATOR_SQL_ROOT_PASSWORD $ACEOPERATOR_SQL_ROOT_PASSWORD

ARG ACEOPERATOR_SQL_USER=ace
ENV ACEOPERATOR_SQL_USER $ACEOPERATOR_SQL_USER

ARG ACEOPERATOR_SQL_PASSWORD=a1b2c3d4
ENV ACEOPERATOR_SQL_PASSWORD $ACEOPERATOR_SQL_PASSWORD

ARG ACEOPERATOR_ADMIN_PASSWORD=a1b2c3d4
ENV ACEOPERATOR_ADMIN_PASSWORD=$ACEOPERATOR_ADMIN_PASSWORD

ARG ACE3_DATA_LOAD_USERS=true
ENV ACE3_DATA_LOAD_USERS $ACE3_DATA_LOAD_USERS

ARG ACE3_DATA_EMAIL_TRANSCRIPT=false
ENV ACE3_DATA_EMAIL_TRANSCRIPT $ACE3_DATA_EMAIL_TRANSCRIPT

ARG ACE3_DATA_USERS=
ENV ACE3_DATA_USERS $ACE3_DATA_USERS

ARG ACE3_DATA_EXIT=false
ENV ACE3_DATA_EXIT $ACE3_DATA_EXIT

ARG ACE3_DATA_RUN_SEED=true
ENV ACE3_DATA_RUN_SEED $ACE3_DATA_RUN_SEED

ARG ACE3_DATA_RUN_PATCH=true
ENV ACE3_DATA_RUN_PATCH $ACE3_DATA_RUN_PATCH

RUN apt-get update; apt-get -y install mariadb-client ncat

COPY work/common/scripts/*.sh /usr/share/aceoperator/bin/
COPY *.sh /usr/share/aceoperator/bin/
RUN chmod +x /usr/share/aceoperator/bin/*.sh

COPY work/.ace /usr/share/aceoperator/.ace
COPY *.sql /usr/share/aceoperator/.ace/sql/

COPY config-override.xml /usr/share/aceoperator/.ace/spring/ace-app/

EXPOSE 6969

CMD ["/usr/share/aceoperator/bin/run.sh"]